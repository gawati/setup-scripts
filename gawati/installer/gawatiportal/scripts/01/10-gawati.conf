<VirtualHost _default_:80>
  DocumentRoot /var/www/html/${GAWATI_URL_ROOT}
  ServerName ${GAWATI_URL_ROOT}
  RedirectMatch 301 ^(?!/\.well-known/acme-challenge/).* https://${GAWATI_URL_ROOT}/v2
</VirtualHost>

<VirtualHost _default_:443>
  ProxyRequests Off
  DocumentRoot /var/www/html/${GAWATI_URL_ROOT}
  ServerName ${GAWATI_URL_ROOT}
  CustomLog logs/${GAWATI_URL_ROOT}/access.log combined
  ErrorLog logs/${GAWATI_URL_ROOT}/error.log
  RedirectMatch ^/$ https://${GAWATI_URL_ROOT}/v2

  SSLEngine on
  SSLProtocol all -SSLv2
  SSLCipherSuite HIGH:MEDIUM:!aNULL:!MD5

  SSLCertificateKeyFile /etc/pki/tls/private/${GAWATI_URL_ROOT_}.key
  SSLCertificateFile /etc/pki/tls/certs/${GAWATI_URL_ROOT_}.crt

  BrowserMatch "MSIE [2-5]" \
         nokeepalive ssl-unclean-shutdown \
         downgrade-1.0 force-response-1.0

  RewriteEngine On
  RewriteRule "^/portal$" "/portal/" [R]

  <Location "/portal/">
    DirectorySlash On
    DirectoryIndex "index.html"

    ProxyPass "${EXIST_ST_URL}/apps/gawati-portal/"
    ProxyPassReverse "${EXIST_ST_URL}/apps/gawati-portal/"
    ProxyPassReverseCookiePath /exist /

    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/portal/xml/">
    AddType text/cache-manifest .appcache
    ProxyPass "${EXIST_ST_URL}/restxq/gw/doc"
    ProxyPassReverse "${EXIST_ST_URL}/restxq/gw/doc"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/doc/">
    AddType text/cache-manifest .appcache
    ProxyPass "${EXIST_ST_URL}/restxq/gw/doc/json"
    ProxyPassReverse "${EXIST_ST_URL}/restxq/gw/doc/json"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/pdf/">
    AddType text/cache-manifest .appcache
    DirectoryIndex "login.html"
    ProxyPass "${EXIST_ST_URL}/restxq/gw/doc/pdf"
    ProxyPassReverse "${EXIST_ST_URL}/restxq/gw/doc/pdf"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/themes/expressions/summary/">
    AddType text/cache-manifest .appcache
    ProxyPass "${EXIST_ST_URL}/restxq/gw/themes/expressions/summary/json"
    ProxyPassReverse "${EXIST_ST_URL}/restxq/gw/themes/expressions/summary/json"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/recent/expressions/summary/">
    AddType text/cache-manifest .appcache
    ProxyPass "${EXIST_ST_URL}/restxq/gw/recent/expressions/summary/json"
    ProxyPassReverse "${EXIST_ST_URL}/restxq/gw/recent/expressions/summary/json"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/searchac/">
    AddType text/cache-manifest .appcache
    
    ProxyPass "${EXIST_ST_URL}/restxq/gw/searchAC/json"
    ProxyPassReverse "${EXIST_ST_URL}/restxq/gw/searchAC/json"
    ProxyPassReverseCookiePath /exist /
    
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/search/year/">
    AddType text/cache-manifest .appcache
    ProxyPass  "${EXIST_ST_URL}/restxq/gw/search/years/summary/json"
    ProxyPassReverse "${EXIST_ST_URL}/restxq/gw/search/years/summary/json"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/search/language/">
    AddType text/cache-manifest .appcache
    ProxyPass  "${EXIST_ST_URL}/restxq/gw/search/languages/summary/json"
    ProxyPassReverse "${EXIST_ST_URL}/restxq/gw/search/languages/summary/json"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/search/keyword/">
    AddType text/cache-manifest .appcache
    ProxyPass  "${EXIST_ST_URL}/restxq/gw/search/keywords/summary/json"
    ProxyPassReverse "${EXIST_ST_URL}/restxq/gw/search/keywords/summary/json"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/search/country/">
    AddType text/cache-manifest .appcache
    ProxyPass  "${EXIST_ST_URL}/restxq/gw/search/countries/summary/json"
    ProxyPassReverse "${EXIST_ST_URL}/restxq/gw/search/countries/summary/json"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/search/filter/">
    AddType text/cache-manifest .appcache
    ProxyPass  "${EXIST_ST_URL}/restxq/gw/search/filter/json"
    ProxyPassReverse "${EXIST_ST_URL}/restxq/gw/search/filter/json"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/keyword">
    AddType text/cache-manifest .appcache
    ProxyPass  "http://localhost:9001/gwp/keyword"
    ProxyPassReverse "http://localhost:9001/gwp/keyword"
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/short-filter-cache/">
    AddType text/cache-manifest .appcache
    ProxyPass  "http://localhost:9001/gwp/short-filter-cache"
    ProxyPassReverse "http://localhost:9001/gwp/short-filter-cache"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/smart-filter-cache/">
    AddType text/cache-manifest .appcache
    ProxyPass  "http://localhost:9001/gwp/smart-filter-cache"
    ProxyPassReverse "http://localhost:9001/gwp/smart-filter-cache"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

  <Location "/gw/service/full-filter-cache/">
    AddType text/cache-manifest .appcache
    ProxyPass  "http://localhost:9001/gwp/full-filter-cache"
    ProxyPassReverse "http://localhost:9001/gwp/full-filter-cache"
    ProxyPassReverseCookiePath /exist /
    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
  </Location>

</VirtualHost>

